# 7.SHELL

### SHELL脚本基础

### shell命令解释器概述

1. 被称为命令解释器,用户在终端输入某个命令，shell对命令进行解释，传递给操作系统，使其执行功能
2. shell执行命令的具体流程:
    1. 从标准输入中读取到操作的关键字，传递到shell层（bash进程）调用fork函数创建一个子进程，exec重载操作系统执行命令所对应的操作功能 #### SHELL语言概述:
- SHELL语言是一种高级的解释型语言,也被称为脚本语言;
    - 解释型语言:编译过程是动态编译过程(修改源代码后可立即执行程序);编译工作无需由用户完成;eg:SHELL,Python
- SHELL语言由命令;

#### SHELL脚本程序概述:

- SHELL是作为用户与Linux系统之间的操作接口程序,能够接受用户向操作系统所输入的终端命令;
- SHELL脚本可以提高某些特定命令集合的重用性
- SHELL脚本是一个命令的集合,用于完成重复固定的输入命令的工作,使系统自动运行一些命令;
- SHELL脚本可以直接通过命令使用系统命令的相关功能,使开发工作更加简便;
- C/C++开发过程中需要调用系统API实现新功能,可近似理解为SHELL语言中使用系统命令开发新功能;

### SHELL的种类:终端的版本

- Bourne shell(sh):Unix操作系统实现
- C shell(csh)
- Korn shell(ksh)
- Bourne Again shell(bash): Ubuntu系统使用

### Linux系统的四层分层:

- 用户+应用层:
    - 启动系统终端,接收键入的命令
- SHELL解释器层:
    - 解释用户键入的命令;调用命令功能
    - SHELL脚本程序基于Linux系统下的SHELL层;
    - SHELL被称为命令解释器;
- 系统内核层:
    - 执行命令的功能
    - ls命令的显示目录下所有文件
- 计算机硬件(驱动层)

### SHELL脚本程序的三要素:

1. 声明:
- 用于声明此程序的**shell解释器版本**(用指定的解释器去解释脚本程序)
- 可用 ***which + 解释器名*** 使用命令找出解释器路径
    
    ```
    #! + 解释器路径(which + 解释器名)
    ```
    
1. 注释:
- 除首行的声明以外,其余任意位置出现 ***#*** 均 ***表示单行注释*** ;
1. 命令与控制流程集合 

#### SHELL脚本的创建与执行流程:

1. 使用SHELL语言编写SHELL脚本程序;
2. 将脚本文件赋予执行权限(sudo + chmod命令),并直接执行该文件;

#!/bin/bash #SHELL脚本的声明 echo 当前用户home目录: #回显字符串“当前用户home目录:” echo $HOME #对环境变量HOME取值并显示 echo 当前目录位置: #回显字符串“当前目录位置:” pwd #执行pwd命令显示当前目录所在位置 #### SHELL变量:
    - 所编写的脚本程序即是可执行程序; shell.sh 为脚本文件;
    - **.sh** 是脚本文件通用后缀
    - 脚本程序也会产生一个进程
    - 权限提升成功后.sh文件会变为一个可执行文件 #### 示例:shell脚本的简单实现
3. 变量(又名:符号)=临时变量+永久变量
4. 临时变量: - 在脚本中定义,生命周期随脚本程序持续;进程结束时临时变量消失; - 作用范围仅限所被定义的脚本程序,对其他程序不可见 - 使用时需先在脚本程序中定义; - 包含用户自定义变量和位置变量;
    - 用户自定义变量:
5. 环境变量(永久变量): - 为系统自带数据生命周期随系统持续,关机后生命周期结束; - 在系统中可直接使用 - 可使用 env命令显示当前系统下所有环境变量,eg:HOME变量
- 注意:
    1. 定义变量名时要有具体意义,从变量名中可以快速获取数据信息的意义
    2. SHELL脚本中的变量名尽可能全部大写;而不是驼峰命名法;
    3. 变量名不允许数字开头
1. 使用变量(符号值):
- 所有shell变量为键值对格式 key=value
- 使用变量的值必须对变量名进行取值操作
    - 取值符号 $
        
        ```
        echo $NAME
        ```
        
- 定义变量时要初始化变量
- 定义变量时必须采用键值对的格式且不能有多余的空格; #### SHELL常见数据修饰符
- " "
- ’ ’
- ` `

### shell脚本示例:开机自启守护进程

SHELL中的四则运算 expr 命令 expr 2 + 3 expr 2 - 3 expr 2 * 3 expr 2 / 3 执行多级运算时，使用expr 嵌套expr expr `expr  ${NUM} + ${NUM2}` * ${NUM3}

多选 不支持直接default

循环 for

while 此处的0为字符，故循环也能进行下去

选择循环：打印目录并可根据编号进行选择

写函数，返回打印输出则有返回，不打印输出则不需返回 有传参概念

应用 使用SHELL脚本完成开机自动启动程序

步骤 1）编写shell脚本， 2）

开机启动的程序 均为 后台运行的程序

/etc/init.d 目录下均为开机运行脚本

若此时shell脚本带有后缀名，可能会引发错误 #!/bin/bash ### BEGIN INIT INFO # Provides: daemon #Required-Start: $remote_fs $syslog # Required-Stop: $remote_fs $syslog # Default-Start: 2 3 4 5 # Default-Stop: 0 1 6 # Description: my testshell ### END INIT INFO

#脚本内容，程序启动 cd /home/colin/colinsoft/CODE2/19-10-6 ./app