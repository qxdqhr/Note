# 哈工大计算机网络原理

WEB应用描述 - 网页; - 网页之间的互相连接所形成的网络; - 网页包含多个对象: - HTML文件;JPEG文件,视频文件,动态脚本 - 基本HTML文件:包含对其它对象引用的链接 - 区分 - WEB对象的寻址:依靠URL(Uniform Resource Locator)统一资源定位器 - 构成: - 协议://主机:服务器端口号/路径 - 省略协议时默认http协议 - 作用:是互联网中各种资源能够互相连接 #### HTTP协议:超文本传输协议 - 万维网所遵循的协议:HyperText Transfer Protocol - HTTP协议采用C-S结构 - 客户端 - 服务器 - 阿帕奇软件Apache - 版本1.0rfc1945 - rfc2068 - 使用TCP传输服务 - 服务器在80端口 - HTTP协议是一个无状态协议 - 服务器不维护任何有关客户端过去所发送请求的信息,不记录历史请求消息 - 发送即返回 - 有状态的协议更复杂 - 需维护协议 #### HTTP链接的类型 - 非持久性链接 - 特性: - 每个TCP连接最多允许传输一个对象 - 用于HTTP1.0版本中 - 总消耗时间=2个RTT+文件传输时间 - 缺点: - 总消耗时间较长 - 多次重复建立TCP链接,开销较大 - 一次TCP数据传输结束后;若传输的HTML文件包含指向其他对象的超链接需要重新开启一次新的TCP链接 - 持久性链接 - 特性: - 每个TCP连接允许传输多个对象 - 用于HTTP1.1版本中 - 发送响应后,服务器保持TCP连接的打开 - 后续解析出的HTTP连接也可通过这个TCP链接打开 - 分类: - 无流水的持久性连接 - 特性: - 客户端只有收到前一个响应后才发送新的请求 - 每个被引用的对象耗时1个RRT - 带有流水机制的持久性链接 - 两类型的区别: -

- RTT(Round Trip Time)
- 从客户短短发送一个很小的数据包到服务器并返回所经历的时间
- 响应时间:
    - 发起,建立TCP连接:1个RTT
    - 发送HTTP请求消息到HTTP响应消息到HTTP

无流水:无需等待一个链接完成后再开始处理一个新连接,使其能够连续发送新连接请求 流水:前一连接处理完成后(请求响应均完成)才开始下一个连接

http请求请求connection的意思: 表明此连接之后是否还有链接close表无其他链接 open表示还有其他链接 Last-Modified:上次修改时间

### Socket Api(套接字程序编程接口)编程:

1. socket api 概述:
    - 网络应用程序开发中大多使用**套接字网络应用程序接口**
    - **套接字程序编程接口**简称为**套接字**,英文**Socket Api**简称为**socket**;
    - 最典型,符合工业标准,绝大操作系统支持
    - 通信模型:C-S模型
2. 针对端系统的网络应用程序的开发:
    - ————————————————————————————
        - 基于已有Web应用程序开发
            - Web:典型CS结构
            - RPC:
            - 中间件编程:
    - 应用层—————————————————————————–
        - 基于NetBIOS编程:Windows下基于会话层开发;
        - 套接字编程:(SOCKET编程)
    - 传输层—————————————————————————–
    - 网络层—————————————————————————–
        - 基于NDIS网络编程(Windows平台;开发网络驱动程序等)
        - 基于网络函数库编程;(C语言)
            - LibPcap/WinPcap:Linux/Unix函数数据包抓包函数库
            - Libnet:网络分组与数据发送构造函数库
            - Libnids:网络入侵检测函数库
            - Libicmp:ICMP协议的报文构造发送处理函数库
    - 数据链路层—————————————————————————–
        - 基于Packet Driver平台的编程(屏蔽网卡细节;适用于所有网卡)
        - 直接对网卡编程(硬件层面)
    - 物理层 ——————————————————————–
3. 应用程序接口API
    1. 如何理解应用程序接口:
        - 两主机应用程序进程通过网络传输数据
        - 这些应用程序进程遵循应用层协议所定义的两进程如何交互(应用层报文信息/应用层交互顺序)
        - 应用层传输数据必定会经由底层操作系统完成数据传输
        - 应用程序在向底层传输数据时需要**应用程序接口**保证数据能从**应用进程**传输到**底层操作系统**中从而最中间数据通过网络发送至另一主机;
        - 应用程序接口是一个**系统调用接口**
        - 能够将**用户进程控制权**与**操作系统控制权**进行转换
    2. 几种典型的应用编程接口:
        1. 套接字接口(socket):Berkeley UNIX操作系统定义
        2. WINSOCK(Windows Socket Interface)微软公司定义
        3. TLI(Transport Layer Interface)AT&T 为UNIX系统定义
4. SOCKET API的通信特点:
    1. 通信时采用抽象机制(类似于文件的抽象)
    - Linux/Unix中抽象为文件描述符
    - Windows中分开管理
    1. 端口号:一个客户端通过端口号区分同一主机中的多个服务器进程;
        - 表明通信端点(对外):IP地址+端口号
        - 操作系统/进程通过套接字描述符管理套接字
        - 是一个16位整数;
5. SOCKET的抽象机制:
    1. 每个进程都包含一个Socket描述符表;其中存储一些Socket的数据结构的地址;
    2. Socket的数据结构存储相关信息
        - 结构类型: sockaddr_in
        
        ```
        struct sockaddr_in
        {
          u_char sin_len;         //地址长度
          u_char sin_family;      //地址族:套接字API所面向的协议栈;TCP/IP协议:AF_INET
          u_short sin _port;      //端口号
          struct in_addr sin_addr;//IP地址
          char sin_zerp[8];       //0空间
        }
        ```
        
6. 常用的套接字API函数:
    1. (WinSock)基本结构:
    - `WSAStartup() //初始化 Windows Sockets API 应用程序 WSACleanup() //释放使用的Windows Sockets DLL`
    - 使用此结构原因:Windows系统下Socket的实现方式是由Windows下的动态链接库实现的
    1. WSAStartup()
        1. 参数:
            1. 程序所使用的WinSock版本,16进制整数,高字节表副版本,低字节表主版本;eg: 0x102 (2.1ver.)
            2. WinSock版本信息结构体的地址;类型:LPWSADATA
        2. 返回值:
        3. 用法:
            1. Win系统下,使用Socket之前必须首先调用的函数
    2. WSACleanup()
        1. 参数:空
        2. 返回值:int
        3. 用法:
            1. 完成对请求的Socket库的使用时调用
            2. 解除对Socket库的绑定
            3. 释放Socket库所占用的系统资源
    3. socket()
        1. 参数:
            1. 协议族(protofamily):指明套接字所面向的协议;TCP/IP协议时为PF_INET
            2. 创建的套接字类型:
                1. SOCK_STREAM 流式套接字(TCP)传输层
                2. SOCK_DGRAM 报式套接字(UDP)传输层
                3. SOCK_RAW 原始套接字(IP/ICMP/IGMP)网络层,需更高权限;
            3. 协议号 :指明面向协议族中具体哪个协议,0 为默认协议
        2. 返回值:由操作系统返回一个套接字描述符;(sd)
        3. 用法:
            1. 创建套接字时直接调用
            2. struct protoent *p; p=getprotobyname(“tcp”); SOCKET sd =socket(PF_INET,SOCKET_STREAM,0);
            3. TCP特点:
                1. 可靠:能保证数据的不会出错丢失/乱序
                2. 面向连接:数据在进行交互时首先要建立一个(逻辑)链接
                3. 字节流传输
                4. 点对点:一个TCP连接只能基于点对点的链接(1 Client-1 Server)
                5. 全双工
            4. UDP
                1. 不可靠:可能会产生数据丢失/乱序
                2. 无连接:数据交互不会事先建立连接
                3. 数据报传输:将数据放入数据报中传输
    4. closesocket()
        1. 参数:
            1. SOCKET sd
        2. 返回值:
            1. 关闭成功时,返回0
            2. 关闭失败时,返回SOCKET_ERROR;
        3. 用法:
            1. 关闭某一描述符为sd的套接字
            2. WIN下是closesocket();
            3. Linux下是close();
            4. 当多进程共享一个套接字时,调用closesocket()时,将套接字引用计数减1,多进程的套接字的套接字引用数减至0时,此套接字才会关闭;
            5. 一个进程中多线程对一个套接字的使用无计数;
                1. 若一个进程中的一个线程调用close socket将一个套接字关闭,该进程中的其它线程也不能访问该套接字;
    5. bind()
        1. 参数:
            1. sd 套接字描述符
            2. localaddr 端点地址
                1. sockaddr_in
            3. addrlen 地址长度
        2. 返回值:
        3. 用法:
            1. 操作系统套接字创建时,为套接字分配空间存储套接字信息
            2. 绑定某个套接字的本地端点(IP+端口号)地址
            3. 客户端程序一般不需要调用bind函数
            4. 服务器端需要调用,且设定端点地址时基本使用INADDR_ANY(地址通配符)表示任意IP地址,避免服务器仅能连接一个主机上的客户端的问题;
    6. listen
        1. 参数:
        2. 返回值:
        3. 注意:
            1. 套接字刚创建时不区分客户端socket或服务器socket
            2. 服务端程序将服务端的套接字设置为监听状态