# TCP-IP协议栈-冲突-皋月朔星_Win10

# TCP/IP协议栈中生成数据包的过程:

## 发送数据包各层的工作:(发送数据的自上而下的过程)

### 应用层：

- 进程形成待传输数据

```
 DATA
```

### 传输层：

- 在DATA外层添加协议头
- 协议头中包含:
    - 使用协议种类
    - 本进程端口号
    - 对方进程端口号
- UDP协议头大小约为8字节
- 协议头大小视协议的不同而不同

```
 P-(DATA)
```

## 网络层：

### 作用：

- 寻找IP地址

### 对数据包的操作

- 在P-(DATA)外层添加IP头
- IP头中记录着发送端主机和接收端主机的IP地址
- IP头大小约为20字节

```
IP-(P-(DATA))
```

## 数据链路层:

- 在IP-(P-(DATA))外层添加LLC逻辑介质层头和MAC头
    - (MAC头+LLC头==帧头)
- 在整个数据尾部加上帧尾
- 帧头大小约为14字节(MAC头+LLC头)
- 帧尾大小约为4字节

## 通过四层模型最终发送的数据包:

MAC头 LLC头 IP头 协议 数据包 帧尾

# 数据包生成后的发送方式

比特流的形式通过光纤或电缆发送

# 收到数据包后的解包流程

- 收到数据包
- 逐层拆包判断,符合对应主机/进程要求,则向上级协议层递送数据包

# 小结

这种先逐层给数据封包，再逐层给数据解包，这种先加的协议最后解开的形式很类似于栈的特性，所以将这几层协议以TCP协议栈的形式描述

# TCP数据包图解:

![https://www.notion.soTCP-IP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/image-20201021171228635.png](https://www.notion.soTCP-IP%E5%8D%8F%E8%AE%AE%E6%A0%88.assets/image-20201021171228635.png)

image-20201021171228635

图中的各个数字均表示位

- 紫色表示TCP协议头
    - UDP协议头仅包含源端口,目的端口,UDP校验,紧急指针
    - UDP协议头仅8字节
- 青色表示IP头(20字节)
    - 生存时间表示当前数据包能够在网络环境中能够存活的时间
    - 没经过一个路由器-1
    - 当值为0时表示此数据包要被丢弃,需要重新发送
- 黄色表示数据链路层中添加的帧头(14字节)
    - 帧尾未在图中表示(4字节)
- 由此图可知:
    - 每一个数据包都含有除数据以外的,较大的外壳
    - 要减少小的数据包频繁的像网络中发送,易造成网络拥塞
- DATA VDP头DATA IP头 CDP头 DATA 应用层:SOCKET 协议层:TCP/UDP

# 通过物理层发送的数据大小范围:

## 以太网数据的范围:

- 46~1500字节
- 包含IP头,协议头,数据包
- 若小于最小值,数据包会被填充(在尾部填充)
- 若大于最大值,数据会被拆分

## 以太网帧的范围:

- 64~1518字节
- (帧头+帧尾)=14+4=18字节
- 包含:帧头,IP,协议,数据包,帧尾