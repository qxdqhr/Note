# 6.线程同步_事件

## 事件：

1. 事件分为人工事件和自动事件，可以置成无信号或有信号
2. 事件是内核模式下的线程同步，可跨进程操作
3. 事件由一个句柄来控制 HANDLE m_hEvent；
4. 创建事件：调用创建事件函数，将句柄初始化为事件（一般在构造函数中使用）
    
    ```
    HANDLE CreateEvent(
            NULL,安全属性
            FALSE(自动重置事件),TRUE(人工重置事件),事件类型
            TRUE(有信号),FALSE(无信号),有无信号
            NULL，事件名（跨进程使用，单进程不用）
        );
    ```
    
5. 等待事件信号（锁定线程同步代码段）：等待事件信号，收到信号则继续向下执行 WaitForSingle（事件句柄，阻塞的时间（INFINITE））； ？？Set事件为有信号SetEvent(事件句柄)；
6. 释放互斥量（解锁线程同步代码段）：ReleaseMutex（互斥量句柄）； 某个取得互斥量的线程的工作结束后要将互斥量释放，使其他线程能够工作。 注意：释放互斥量时，被锁定的代码段可能不止一个出口（if嵌套产生），需多次释放。
7. 关闭事件：CloseHandle（事件句柄）； 判断句柄是否存在，关闭事件句柄，句柄附为空，一般在关闭函数中实现

### 关于人工事件和自动事件

创建事件时直接创建自动事件 人工事件需要设置关闭，等到信号后将事件置为无信号（手动操作） 1） 2）失败 假设有多跟线程，发现有信号都挤进去，可能两个同时都挤进去，挤进一个就设为无信号，存在有的挤进去，有的挤不进去，使一张票被卖了两次