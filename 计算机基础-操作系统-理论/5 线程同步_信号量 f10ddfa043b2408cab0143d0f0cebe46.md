# 5.线程同步_信号量

## 信号量

- 可释放指定个数的信号量
- 能够在同一时刻只允许一个线程访问一个代码段
- 信号量能够控制工作线程的数量;

## 使用时可以同时释放多个信号量;

- 基于信号量的个数计算,当一个线程得到一个信号量时,信号量计数器减一; 信号计数器至零后,直接进入阻塞状态,再来信号量时继续运行; 优势:可以控制确定数量的线程去完成某一工作;

## 创建一个信号量:

```
CreateSemaphore(
    0,安全属性
    1,初始化的信号量数量;
    10,单次最多允许释放信号的总数，大于总数则无效
    0,名字,用与跨进程通信
);
```

释放一个信号量:

同一时刻仅允许只有一个人再买票 ### 注意: 1. 释放信号量时单次释放不可超过总体信号量的最大值; - 假设此时信号量最大值为10; - 情况1:一次调用Release函数释放11个信号量 - 结果:没有信号量被释放,11>10,本次释放无效,没有信号量被释放掉; - 情况2:多次调用Release函数释放4,4,5个信号量 - 1st:释放成功,剩余6个信号量 - 2nd:释放成功,剩余2个信号量 - 3rd:释放失败,剩余2个信号量 - 结果:释放成功8个信号量

- 即,若一次释放的信号量数量大于总信号量数,则此次释放无效(超过最大值); Waitsingleobject函数能够接受的信号