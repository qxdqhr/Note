MFC:微软基础类库(Microsoft Foundation Class)
命令消息:工具条,菜单栏,快捷键发送的消息
添加步骤:编辑按钮->添加事件处理程序
标准消息:鼠标,键盘,定时器,重绘消息
添加步骤:类视图->事件向导
自定义消息:(发送自定义消息的函数)
SendMessage
PostMessage
使用两函数发送消息
# 如何发送一个自定义消息
## MFC中提供的5个类对应的控件:
### Dlg:
- 窗口中出现的对话框(窗口中点击问号出现的对话框)
### FrameWnd:
- 创建运行出来的整个窗口(去除中间白色区域)
### View:
- 视图(窗口中的白色区域)
### App:
- 应用程序(包含整个窗口及窗口中的所有元素)


此类包含有
- 主函数的四个参数
  - 有主窗口
  - 实例句柄

## MFC中各类中的作用以及关系:

### CObject类:基类
#### 与其它类关系:
- 是MFC提供的绝大多数类的基类(被大部分类所继承)，本身并不提供功能;
#### 主要工作:
- 主要是通过6个宏完成实际工作。
- 主要完成**动态空间的分配与回收**，支持一般的**诊断、出错信息处理**和**文档序列化**等。
- **动态类型创建和识别**都是在这里进行处理。

### CCmdTarget类:和消息有关的类继承此类
#### 与其它类关系:
- 是CObject类直接派生出的子类，是MFC消息映射结构的基类;
#### 主要工作:
- 管理消息映射;
  - 消息映射**将系统事件（命令消息）和窗口事件（标准消息）发送给响应这些事件的对象**，**完成消息发送、等待和调度工作**，实现应用程序对象之间的协调运行。
- 回调函数中遍历消息映射表匹配传入消息,调用对应函数
- 消息传来时,匹配的消息映射表可能不止一个(每个类均有消息映射表),匹配顺序根据具体消息决定

### CWinThread类:
#### 主要工作:
- 主要用来完成对**线程的控制**，包括线程的创建、运行、终止和挂起等。
  - 单线程:主函数->return 0结束
  - 多线程:同一程序中另出现一套主函数于主线程并行运行

### CWinApp类:程序本体类
-  程序本体是指与**程序本身有关**而与**窗口无关的数据或动作。**
   -  比如，WinMain(主函数中)传递的四个参数:实例句柄,注册窗口类，分派消息等。
#### 主要工作:
- 管理程序的生死，操纵每个对象的产生。
  - (关键的函数：InitApplication/InitInstance)（应用类）
  - 此类封装了Windows应用的初始化、运行以及终止的全过程。
#### theApp对象:
- CWinApp类是应用程序的管理者
- App类的源文件(UsrMsg.cpp)中定义了一个叫做theApp的全局对象(MFC中的全局对象)
- 程序tWinMain(主函数)执行之前会先构造theApp对象。
- 对于每一个基于框架应用，它必须且只能有一个派生于CWinApp的类对象。这个对象的特别之处在于它是一个全局对象，因此它在创建任何窗口前首先被构造。
#### CWinApp类中的重要成员:
##### WinMain函数的四个参数:
- (**对应于GameApp中的实例句柄成员变量**,eg:m_hInstance)
   -  m_hInstance(实例句柄)
   -  m_hPrevInstance
   -  m_lpCmdLine
   -  m_nCmdShow
##### 传统的WinMain函数中的三个函数:
- (**对应于GameApp中的操作函数**,eg:OnGameRun())
   -  InitApplication()
   -  InitInstance()
   -  Run()
##### 主窗口的handle:
- (**对应于GameApp中的主窗口句柄成员变量**,eg:m_pMainWnd)
   -  一个程序可能有多个窗口,但一定只有一个主窗口
   -  此成员不在CWinApp类中，而是在CWinThread类中实现
   -  在CWinThread类中，有一个指向窗口类的指针的成员变量,表示主窗口(Frame)的指针:CWnd* m_pMainWnd
##### 类中关键的可重载的虚成员函数:
- InitInstance()
- Run()
- ExitInstance()
- OnIdle()
##### 获得CWinApp类对象的指针函数:
- AfxGetApp();
  - 全局函数在程序中可以随时调用

### CWnd类:提供所有窗口类的基本功能
#### CWnd对象与Windows的窗口的关系:
- CWnd对象是由CWnd类的构造函数和析构函数创建或销毁的;
- Windows的窗口是Windows系统中的一种内部数据结构;
- Windows的窗口是由CWnd对象调用Create成员函数创建的,由CWnd对象调用虚拟析构函数销毁;
- 并且DestroyWindow函数只销毁Windows的窗口,不销毁CWnd对象;
#### CWnd对象的使用:
- 由于Windows中窗口种类很多;
- 直接定义窗口时并不会使用CWnd类(CWnd类是窗口父类);
- 而是用对应窗口的类(Frame,View,Dialog..)去定义窗口对象(继承CWnd类);

- CWnd类和消息映射机制隐藏了WndProc函数。
- 接收到的Windows通知消息通过消息映射被自动发送到适当的CWnd OnWndMsg成员函数。
- 你可以在派生类中重载OnWndMsg成员函数以处理成员的特定消息。

- CWnd类同时还使你能够为应用程序创建Windows的子窗口。
- 先从CWnd继承一个类，然后在派生类中加入成员变量以保存与你的应用程序有关的数据。
- 在派生类中实现消息处理成员函数和消息映射，以指定当消息被发送到窗口时应该如何动作。

### CFrameWnd类:
#### 主要工作:
- 用于创建应用程序的主窗口;(被App中的主窗口指针所指向)
- 菜单栏,工具条,状态栏,视图,文档等控件均位于主窗口之上;并由主窗口进行管理;
- 在编写文档/视图结构的应用程序时，CFrameWnd作为主窗口管理视图和文档对象。
- 视图对象和控制条都成为CFrameWnd的子窗口，它们分享客户区，其位置被CFrameWnd有效地排列。
  - 非客户区: 标题+菜单栏
  - 客户区:   
- CFrameWnd直接支持单文档界面（SDI），对于多文档界面（MDI），使用其派生类CMDIFrameWnd和CMDIChildWnd。

### CView视图类:
- 主要功能是显示文档数据，并接受用户对数据的修改。它以图形化方式将数据显示出来，并提供了与用户交互的接口，将用户的输入操作解释为对文档对象的操作。
- 一个视图对象只能与一个文档对象连接，视图类是文档与用户间进行联系的纽带，当用户打开一个窗口或分割一个窗口时，程序框架就会构造一个视图类对象与文档相关联，一个文档对象可连接多个视图对象。
- 当文档对象发生变化时，与该文档连接的所有视图都应做出反应，这一过程通过调用CDocument::UpdateAllViews()函数来得到实现。
- CView成员不太多，同CDocument类似，它也只提供了基础、必要的框架，用户通过对该类的派生来充实所需的功能。

### CDialog类:
- 是在屏幕上显示的对话框基类。
- 对话框有两类：模态对话框和非模态对话框。
  - 模态对话框在应用继续进行之前必须关闭。
  - 非模态对话框允许用户执行另外的操作而不必取消或删除该对话框。



CObject类:大部分类都继承此类
CCmdTarget类:处理消息管理消息
回调函数中
查找完这个类再找下一个类的消息映射表

CWinThread线程类:完成对线程的控制

18.25
视图类:用于绘图的类,画图的代码都要写再此类中(OnDraw函数)
数据---------------用户
数据-----|视图|-----用户

对话框类:
种类:
模态对话框:此窗口被打开时不能操作其他窗口
非模态对话框:

总结
App:表示当前的应用程序
3各成员:四个参数

文档类:存储数据
视图类:绘图


18.45
# 自定义消息的发送:
## 区别:
SendMessage();
PostMessage();
## 视图区域鼠标左键,并向frame发送自定义消息,frame中接受消息并显示对话框
### 向frame发送自定义消息:
视图类中添加消息:LButtonDown()
消息行为函数中要给Frame发送一个消息
再stdafx.h中定义一个消息(宏):#define UM_VIEW_TO_FRAME (UM_USER)
    此时为防止使用UM_USER开始定义
    要拿到frame;frame在程序.主窗口->窗口句柄
    SendMessage(


    )
### frame中接受消息并显示对话框:
在frame类中添加新的消息行为函数,加入显示对话框
并在消息映射表中添加消息映射
自定义的消息映射:ON_MESSAGE(消息宏,消息函数地址)
## frame像视图类发消息

其他发送消息方式:
使用MFC的成员函数发送
theApp.m_pMainWnd->sendMessage(UM_VIEW_TO_FRAME)
使用

总结:
MFC中类间关系:获取发送对象才能调用send/post函数

消息映射表