# 如何建立一个MFC项目
- 新建MFC应用程序
- 应用程序类型:单个文档
- 项目类型:MFC标准
# MFC概述(Microsoft Foundation Class)
一个MFC是已经建立好的窗口的应用程序项目
可以直接在对话框中加入按钮等控件:资源视图中,打开窗口控件即可进行编辑
# 为什么要学MFC
## 框架:封装好的用于二次开发的程序
### 框架举例:
- Win32:可使用C语言编程的框架
- MFC:C++中的一种框架
### 框架的出现原因:
- 将一系列重复性高的,功能少的代码进行封装,简化开发过程,增强扩展复用性
- 框架应能够直接被使用,并且使用时框架内部不应被修改
### 学习框架的目的
- 学习框架的目的是学会如何使用,学习框架的过程类似于学习STL中的容器的使用
- 语言的学习:自下而上的学习,重点在于知识
- 框架的学习:自上至下的学习,重点在于使用(清楚要实现功能中要使用的函数)
# Win32应用程序的运行特点:
## 整体流程:
- 窗口创建(注册窗口显示)--->添加控件----->使用控件
## Win32SDK中消息的传递:
- 用户发出不同的消息
- 所有消息传入WndProc回调函数中(uMsg参数)
- 根据所传入的不同消息种类执行对应的操作(对象调用函数)
# 再议简易游戏壳:
- 简易游戏壳也可以被认为是一种使用Win32Api的框架
- 但作为框架的封装性以及扩展复用性还不够完善
- 游戏壳中通过**虚函数接口,子类继承并重写实现**的机制实现
## 游戏壳的改进(1):游戏壳不能容纳所有的虚函数消息
- 假设此时存在一个新功能,并且未在游戏壳中实现对应消息的函数;
- 则需要在游戏壳中添加新消息的虚函数并在回调函数中调用;
- 这样游戏壳中被修改违反了游戏壳设计的初衷:只使用而不修改的编写程序
## 游戏壳的改进(2):虚函数较多浪费空间
- 假设在游戏壳中添加所有的消息函数并且将其作为虚函数,又会产生许多问题(全部函数以虚函数方式出现占用较大无用空间)
## 游戏壳的改进(3):放弃虚函数重写机制
- 不使用继承作为接口方式,选择函数指针的接口方式
- 直接在不同类中设定函数指针指向具体类中的一些函数
- 同时在消息函数中使用上述函数指针来调用具体类中函数
- 每次调用时只要使用函数指针执行功能即可
## 游戏壳的改进(4):
- 再次增加新消息时,无需再在父类中实现虚函数,直接在消息函数中使用函数指针调用即可
- 定义函数指针时,将每一个消息对应于一个函数指针

每个消息于其一一对应的函数功能的指针所形成的表(数组)被称为消息映射表

有了消息映射表即可将消息函数进行进一步优化修改
在消息函数中使用循环匹配方式
使用一个指向消息映射表的指针一直在消息映射表中循环
一旦这个指针遍历到待调用的函数所对应的消息时,就能够直接执行消息所对应的函数指针所对应的行为函数

这样即使添加新的消息时,直接在消息映射表中添加对应的新消息所对应的函数指针并定义函数即可
无需再像原来那样:父类添加虚函数->子类重写函数->消息函数中定义新case

但消息循环只判断将消息交给哪个类的对象去执行相应函数
而实际使用函数的依旧是类对象执行

当有多个类同时要执行函数时,每个类各自有一套消息映射表

函数功能<-----|--函数指针,对应消息


WndProc(uMsg)
{
    while(temp)
    {
        if(t>uMsg==uMsg)
        {
            (temp->*pfn)();
        }
        yemp++;
    }
}
窗口出白色位置鼠标左键点击弹出对话框
窗口:frame
窗口白色:view视图
消息映射表中找到对应操作的消息,无此消息则添加新消息在消息映射表中
找到对应的函数指针
找到对应的函数
添加对应的操作

具体操作:
打开视图的头文件与原文件
头文件中声明一个函数
消息映射表中添加
BEGIN MESSAGEMAP
源文件中定义一个函数定义


快捷操作
类视图->对应控件的类->右键->属性->消息->找到对应消息函数->函数定义完成&消息映射表定义完成
调用MESSAGEbox函数;

示例:
菜单栏鼠标左键坦对话框
Frame中添加NcLbuttonDown函数非客户区
LButtonDown会失败此函数表示客户区指针

TRACE();printf函数类似用于测试函数能够在输出区域输出对应文字,格式化输出
按下键盘向左方向键弹出对话框
拥有键盘焦点的窗口才可以收到键盘消息

MFC消息分为几类:
标准消息:
添加方法:
- 命令消息:菜单,工具栏按钮,组合键消息
- 菜单:
  - 添加消息按钮:
    - 菜单中Menu在尾部新添加一个
  - 在要添加消息函数的按钮上右键->事件处理程序向导
  - 向导中左边默认命令消息
  - 右边会列出目前的所有的类
  - ,此消息在xxx19.35
控件/通知消息
自定义消息

关于Messagebox函数:
调用时不加::  表示使用MFC的成员函数(省略了this->Messagebox),仅1个参数
调用时加::    表示使用WIndows API中的全局函数,三个参数
AfxMessageBox   MFC中的全局函数
产生原因:部分函数名相同,以作用域区分



afx_msg 是一个宏,但转定义后没有源,表示此函数是消息函数,为提高代码可读性而产生,无实际作用
工具栏添加按钮消息没有向导按照一般步骤添加消息
在frame.h处添加消息函数声明(加afx_msg),
frame.cpp中添加消息函数定义
在资源视图中记录所添加控件的ID(属性)
消息映射表中BEGIN_MESSAGE_MAP
添加新的一项
	ON_COMMAND(ID_BUTTON32777, &CMainFrame::OnToolBar)
      命令消息 (   控件ID     , 对应函数地址)
完成

https://blog.csdn.net/lichen18848950451/article/details/68062479